<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>src/events.html - Protoboard</title>

  <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">

  <link rel="stylesheet" href="../assets/css/class.css">
  <link rel="stylesheet" href="../assets/css/events.css">
  <link rel="stylesheet" href="../assets/css/index.css">
  <link rel="stylesheet" href="../assets/css/main.css">
  <link rel="stylesheet" href="../assets/css/method.css">
  <link rel="stylesheet" href="../assets/css/prettyprint.css">
  <link rel="stylesheet" href="../assets/css/props.css">
  <link rel="stylesheet" href="../assets/css/sidebar.css">
  <style>
    @import url(http://fonts.googleapis.com/css?family=Roboto);
    @import url(http://fonts.googleapis.com/css?family=Ubuntu+Mono);

    body {
      background-color: #222;
      color: white;
      display: flex;
      flex-direction: column;
      font-family: 'Roboto', Helvetica, Arial, sans-serif;
      font-size: smaller;
      line-height: 3ex;
      margin: 0;
      height: 100vh;
    }

    .description code {
      color: #F6F080;
      background-color: #444;
      border-radius: 4px;
      padding: 2px 4px;
    }

    h1, h2 {
      margin: 5px 0;
    }

    a, a:visited {
      color: gold;
      text-decoration: none;
    }

    a.external {
      color: darkorange;
    }

    a:hover {
      text-decoration: underline;
    }

    pre,
    code,
    a.crosslink {
      font-family: 'Ubuntu Mono', monospace;
    }

    .prettyprint code {
      background-color: transparent;
      border-radius: 0;
      padding: 0;
    }

    code .keyword {
      color: #808080;
    }

    div.content {
      max-width: 50em;
    }

    section.collapsible > header {
      background-color: #004000;
      padding: 5px 20px;
      cursor: pointer;
      -webkit-user-select: none;
      transition: padding .2s;
      position: relative;
    }

    section.collapsible > header h2 {
      font-size: 1.2em;
    }

    section.collapsible > header::after {
      background-image: -webkit-linear-gradient(270deg, #004000, transparent);
      content: '';
      display: block;
      height: 10px;
      position: absolute;
      width: 100%;
      left: 0;
      bottom: -10px;
    }

    section.collapsible.collapsed > header {
      padding-bottom: 5px;
    }

    section.collapsible > div {
      overflow: hidden;
      transition: height .2s;
    }

    footer {
      border: 2px solid #004000;
      padding: 15px;
      -webkit-margin-before: 20px;
    }

    header.tutorial {
      color: #008000;
    }
  </style>
  <style>
    header.main-header h1 a {
      color: #008000;
    }
  </style>
</head>
<body>
  <header class="main-header">
    <div>
      <h1><a href="../index.html">Protoboard</a></h1>
      <span class="main-subtitle">v 0.1.0</span>
    </div>
    <a href="https://github.com/garysoed/protoboard">GitHub</a>
  </header>
  <section class="main-content">
    <section class="main-sidebar"><div class="sidebar">
    <section class="collapsible ">
      <header>
        <h2>tutorial</h2>
      </header>
      <div>
        <ul>
          <li class="">
            <a href="../classes/1 Overview.html">1 Overview</a>
          </li>
          <li class="">
            <a href="../classes/2 Prerequisites.html">2 Prerequisites</a>
          </li>
          <li class="">
            <a href="../classes/3 Components.html">3 Components</a>
          </li>
        </ul>
      </div>
    </section>
    <section class="collapsible ">
      <header>
        <h2>api</h2>
      </header>
      <div>
        <ul>
          <li class="">
            <a href="../classes/ability.Abilities.html">ability.Abilities</a>
          </li>
          <li class="">
            <a href="../classes/ability.Abilities.Builder.html">ability.Abilities.Builder</a>
          </li>
          <li class="">
            <a href="../classes/ability.Ability.html">ability.Ability</a>
          </li>
          <li class="">
            <a href="../classes/ability.Droppable.html">ability.Droppable</a>
          </li>
          <li class="">
            <a href="../classes/ability.Pickable.html">ability.Pickable</a>
          </li>
          <li class="">
            <a href="../classes/ability.Shuffleable.html">ability.Shuffleable</a>
          </li>
          <li class="">
            <a href="../classes/ability.Toggleable.html">ability.Toggleable</a>
          </li>
          <li class="">
            <a href="../classes/Check.html">Check</a>
          </li>
          <li class="">
            <a href="../classes/component.Card.html">component.Card</a>
          </li>
          <li class="">
            <a href="../classes/component.Component.html">component.Component</a>
          </li>
          <li class="">
            <a href="../classes/component.Token.html">component.Token</a>
          </li>
          <li class="">
            <a href="../classes/DI.BindingTree.html">DI.BindingTree</a>
          </li>
          <li class="">
            <a href="../classes/DI.Provider.html">DI.Provider</a>
          </li>
          <li class="">
            <a href="../classes/DI.Scope.html">DI.Scope</a>
          </li>
          <li class="">
            <a href="../classes/Events.html">Events</a>
          </li>
          <li class="">
            <a href="../classes/Events.Action.html">Events.Action</a>
          </li>
          <li class="">
            <a href="../classes/HammerWrapper.html">HammerWrapper</a>
          </li>
          <li class="">
            <a href="../classes/PbElement.html">PbElement</a>
          </li>
          <li class="">
            <a href="../classes/region.Bag.html">region.Bag</a>
          </li>
          <li class="">
            <a href="../classes/region.Bag.RandomPickable.html">region.Bag.RandomPickable</a>
          </li>
          <li class="">
            <a href="../classes/region.Deck.html">region.Deck</a>
          </li>
          <li class="">
            <a href="../classes/region.Hand.html">region.Hand</a>
          </li>
          <li class="">
            <a href="../classes/region.Hand.ReorderableDroppable.html">region.Hand.ReorderableDroppable</a>
          </li>
          <li class="">
            <a href="../classes/region.Rect.html">region.Rect</a>
          </li>
          <li class="">
            <a href="../classes/region.Rect.FlexDroppable.html">region.Rect.FlexDroppable</a>
          </li>
          <li class="">
            <a href="../classes/region.Region.html">region.Region</a>
          </li>
          <li class="">
            <a href="../classes/service.Move.html">service.Move</a>
          </li>
          <li class="">
            <a href="../classes/service.Preview.html">service.Preview</a>
          </li>
          <li class="">
            <a href="../classes/service.Registry.html">service.Registry</a>
          </li>
          <li class="">
            <a href="../classes/surface.RectGrid.html">surface.RectGrid</a>
          </li>
          <li class="">
            <a href="../classes/trigger.Click.html">trigger.Click</a>
          </li>
          <li class="">
            <a href="../classes/trigger.DoubleClick.html">trigger.DoubleClick</a>
          </li>
          <li class="">
            <a href="../classes/trigger.Key.html">trigger.Key</a>
          </li>
          <li class="">
            <a href="../classes/trigger.Key.Service.html">trigger.Key.Service</a>
          </li>
          <li class="">
            <a href="../classes/trigger.Trigger.html">trigger.Trigger</a>
          </li>
          <li class="">
            <a href="../classes/ui.Preview.html">ui.Preview</a>
          </li>
          <li class="">
            <a href="../classes/ui.Previewer.html">ui.Previewer</a>
          </li>
          <li class="">
            <a href="../classes/ui.Template.html">ui.Template</a>
          </li>
          <li class="">
            <a href="../classes/Utils.html">Utils</a>
          </li>
        </ul>
      </div>
    </section>
</div>


</section>
    <section class="main-main"><h4>src/events.html</h4>

<pre class="code prettyprint linenums">
&lt;base href=&quot;..&quot;&gt;

&lt;link rel=&quot;import&quot; href=&quot;out/hammerwrapper.html&quot;&gt;
&lt;link rel=&quot;import&quot; href=&quot;out/third_party/keypress.html&quot;&gt;
&lt;link rel=&quot;import&quot; href=&quot;out/utils.html&quot;&gt;

&lt;script&gt;
DI.bind(&#x27;pb_Events&#x27;, (HammerWrapper, Keypress, Utils) =&gt; {

  // Private symbols.
  const __element__ = Symbol();
  const __elementScopeMap__ = Symbol();
  const __registryRef__ = Symbol();
  const __scopeMap__ = Symbol();

  const __isRegistered__ = Symbol(&#x27;isRegistered&#x27;);
  const __register__ = Symbol(&#x27;register&#x27;);
  const __unregister__ = Symbol(&#x27;unregister&#x27;);

  const TYPES = {
    DOM: &#x27;dom&#x27;,
    HAMMER: &#x27;hammer&#x27;,
    JQUERY: &#x27;jquery&#x27;,
    KEYBOARD: &#x27;keyboard&#x27;
  };

  const HANDLERS = {
    [TYPES.DOM]: {
      register: (action, eventName, handler) =&gt; {
        action[__element__].addEventListener(eventName, handler);
      },
      unregister: (action, eventName, handler) =&gt; {
        action[__element__].removeEventListener(eventName, handler);
      }
    },

    [TYPES.HAMMER]: {
      register: (action, eventName, handler) =&gt; {
        HammerWrapper.on(action[__element__], eventName, handler);
      },
      unregister: (action, eventName, handler) =&gt; {
        HammerWrapper.off(action[__element__], eventName, handler);
      }
    },

    [TYPES.JQUERY]: {
      register: (action, eventName, handler) =&gt; {
        $(action[__element__]).on(eventName, handler);
      },
      unregister: (action, eventName, handler) =&gt; {
        $(action[__element__]).off(eventName, handler);
      }
    },

    [TYPES.KEYBOARD]: {
      __registryRef__: Symbol(),
      register: (action, eventName, handler) =&gt; {
        let ref = new Keypress();
        ref.simple_combo(eventName, handler);
        action[__element__][this[__registryRef__]] = ref;
      },
      unregister: (action, eventName, handler) =&gt; {
        action[__element__][this[__registryRef__]].stop_listening();
      }
    }
  };

  class Action {

    /**
     * Helper class for using {{#crossLink &quot;Events&quot;}}{{/crossLink}}.
     * @class Events.Action
     * @constructor
     * @param {Element} element Element to operate on.
     * @param {Object} scope Scope of the registered events.
     */
    constructor(element, scope) {
      this[__element__] = element;

      if (!this[__element__][__scopeMap__]) {
        this[__element__][__scopeMap__] = new Map();
      }

      if (!this[__element__][__scopeMap__].has(scope)) {
        this[__element__][__scopeMap__].set(scope, new Map());
      }

      this[__elementScopeMap__] = this[__element__][__scopeMap__].get(scope);
    }

    /**
     * @method __isRegistered__
     * @param {string} type The type of event to be checked.
     * @param {string} eventName Name of the event to be checked.
     * @private
     */
    [__isRegistered__](type, eventName) {
      if (!this[__elementScopeMap__].get(type)) {
        return false;
      }

      return this[__elementScopeMap__].get(type).has(eventName);
    }

    /**
     * Registers the given handler to the given event name for the given type.
     *
     * @method __register__
     * @param {string} type The type of event to register the handler to.
     * @param {string} eventName Name of the event to register the handler to.
     * @param {Function} handler Handler to be called for the given event.
     * @return {Events} The Events object for chaining.
     * @private
     */
    [__register__](type, eventName, handler) {
      if (this[__isRegistered__](type, eventName)) {
        return this;
      }

      HANDLERS[type].register(this, eventName, handler);

      if (!this[__elementScopeMap__].has(type)) {
        this[__elementScopeMap__].set(type, new Map());
      }

      this[__elementScopeMap__].get(type).set(eventName, handler);
      return this;
    }

    /**
     * Unregisters the handlers in the scope for the element.
     *
     * - If only type and eventName are given, all handlers listening to that event name of that type
     *   will be unregistered.
     * - If only type is given, all handlers listening for that type will be unregistered.
     * - If nothing is given, all handlers in the scope will be unregistered.
     *
     * @method __unregister__
     * @param {string=} type Type of event to unregister.
     * @param {string=} eventName If given, all handlers listening to this event will be
     *     unregistered.
     * @return {!Events} The Events object for chaining.
     * @private
     */
    [__unregister__](type, eventName) {
      if (!type) {
        // Unregisters all events.
        for (let registeredType of this[__elementScopeMap__].keys()) {
          this[__unregister__](registeredType);
        }
        return this;
      }

      let typeMap = this[__elementScopeMap__].get(type);
      if (!typeMap) {
        return this;
      }

      if (!eventName) {
        // Unregisters all events of the given type.
        if (typeMap) {
          for (let event of typeMap.keys()) {
            this[__unregister__](type, event);
          }
        }
        return this;
      }

      let registeredEvent = typeMap.get(eventName);
      if (registeredEvent) {
        // Unregister the given event name.
        HANDLERS[type].unregister(
            this,
            eventName,
            registeredEvent);
        this[__elementScopeMap__].get(type).delete(eventName);
      }

      return this;
    }

    /**
     * Calls on method of the corresponding type on the element, registering the given event name
     * and handler.
     *
     * @method on
     * @param {string} type The registration type.
     * @param {string} eventName Name of the event to register the handler to.
     * @param {Function} handler Handler to be called for the given event.
     * @return {Events.Action} The Action object for chaining.
     */
    on(type, eventName, handler) {
      return this[__register__](type, eventName, handler);
    }

    /**
     * Calls off method of the corresponding type on the element, unregistering the handlers in the
     * scope for the element.
     *
     * - If eventName is given, all handlers listening to that event name will be unlistened.
     * - If nothing is given, all handlers in the scope will be unlistened.
     *
     * @method off
     * @param {string} type The registration type.
     * @param {string} [eventName] If given, all handlers listening to this event will be
     *     unlistened.
     * @return {Events.Action} The Action object for chaining.
     */
    off(type, eventName) {
      return this[__unregister__](type, eventName);
    }
  }

  /**
   * Utility class to register / unregister events easily. This library handles 4 methods of
   * registrations:
   * - DOM
   * - &lt;a href=&quot;http://hammerjs.github.io/&quot;&gt;HammerJS&lt;/a&gt;
   * - &lt;a href=&quot;http://jquery.com/&quot;&gt;JQuery&lt;/a&gt;
   * - &lt;a href=&quot;http://dmauro.github.io/Keypress/&quot;&gt;Keypress&lt;/a&gt;
   *
   * For a given scope object, only one handler can be bound to an event type.
   *
   * &#x60;&#x60;&#x60;javascript
   * var scope = {};
   *
   * // Register for events.
   * Events.of(element, scope)
   *     .on(&#x27;dom&#x27;, &#x27;click&#x27;, handleClick)        // Handles DOM click event.
   *     .on(&#x27;hammer&#x27;, &#x27;tap&#x27;, handleTap)         // Handles HammerJS tap event.
   *     .on(&#x27;jquery&#x27;, &#x27;mouseup&#x27;, handleMouseUp) // Handles mouseup event through JQuery.
   *     .on(&#x27;keyboard&#x27;, &#x27;a&#x27;, handleKeyA);       // Handles keypress a
   *
   * // Unregister events in the given scope.
   * Events.of(element, scope)
   *     .off(&#x27;hammer&#x27;)         // Unregisters all hammer events.
   *     .off(&#x27;dom&#x27;, &#x27;click&#x27;)   // Unregisters all DOM click events.
   *     .off();                // Unregisters all events in this scope.
   * &#x60;&#x60;&#x60;
   *
   * @class Events
   * @static
   */

  let Events = {
    /**
     * Creates an Events object that operates on the given element with the given scope.
     *
     * @method of
     * @param {Element} element The element to operate on.
     * @param {Object} scope Scope of the registered events.
     * @return {Events.Action} Chainable action object.
     * @static
     */
    of(element, scope) {
      return new Action(element, scope);
    }
  };

  if (window[&#x27;TEST_MODE&#x27;]) {
    Events.Action = Action;
  }

  return Events;
});
&lt;/script&gt;
</pre>

</section>
  </section>
</body>
  <script src="../assets/vendor/prettify/prettify-min.js"></script>
  <script>prettyPrint();</script>
  <script>
    var els = document.querySelectorAll('section.collapsible');
    for (var i = 0; i < els.length; i++) {
      var section = els.item(i);
      var content = section.querySelector('div');
      var header = section.querySelector('header');
      var height = content.clientHeight + 'px';
      header.addEventListener('click', function(section, content, contentHeight) {
        section.classList.toggle('collapsed');
        content.style.height = section.classList.contains('collapsed') ? '0' : contentHeight;
      }.bind(header, section, content, height));
      content.style.height = height;
    }
  </script>
</html>
