<base href="../..">

<link rel="import" href="out/ability/abilities.html">
<link rel="import" href="out/ability/droppable.html">
<link rel="import" href="out/ability/shuffleable.html">
<link rel="import" href="out/di.html">
<link rel="import" href="out/region/region.html">
<link rel="import" href="out/trigger/key.html">
<link rel="import" href="out/utils.html">

<link rel="stylesheet" type="text/css" href="out/region/deck.css">

<template>
  <div id="root">
    <content></content>
  </div>
</template>

<script>
DI
    .constant('doc', document.currentScript.ownerDocument)
    .with('template', doc => doc.querySelector('template'))
    .bind('pb_region_Deck', (
        $registry,
        Abilities, 
        Droppable,
        Key,
        Region, 
        Shuffleable, 
        Utils,
        doc,
        template) => {

  /**
   * Represents a collection of items that can be sorted. To use this, create a `pb-r-deck` element.
   * Any child elements of this class are considered to be in the deck.
   *
   * ```html
   * <!-- Example: Deck containing two cards -->
   * <pb-r-deck>
   *   <pb-c-card id="card1">
   *     <div class="pb-front">Front</div>
   *     <div class="pb-back">Back</div>
   *   </pb-c-card>
   *   <pb-c-card id="card2">
   *     <div class="pb-front">Front</div>
   *     <div class="pb-back">Back</div>
   *   </pb-c-card>
   * </pb-r-deck>
   * ```
   *
   * Supported abilities:
   * - [[Droppable|ability.Droppable]]: Default enabled.
   * - [[Shuffleable|ability.Shuffleable]]: Default enabled on double click.
   *
   * @class region.Deck
   * @extends region.Region
   */

  const EL_NAME = 'pb-r-deck';

  class Deck extends Region {

    /**
     * Called when the element is created.
     *
     * @method createdCallback
     */
    createdCallback() {
      super.createdCallback();
      this.createShadowRoot().appendChild(Utils.activateTemplate(template, doc));
      this.attachedCallback();
    }

    /**
     * Called when the element is attached to the document.
     *
     * @method attachedCallback
     */
    attachedCallback() {
      super.attachedCallback();
    }

    /**
     * Called when the element is detached from the document.
     *
     * @method detachedCallback
     */
    detachedCallback() {
      super.detachedCallback();
    }
  }

  Abilities.of(Deck.prototype)
      .add(new Shuffleable('shuffleable', new Key('s'), true))
      .add(new Droppable('droppable', new Key('d'), true));

  $registry.add(EL_NAME, Deck.prototype);

  return Deck;
});
</script>