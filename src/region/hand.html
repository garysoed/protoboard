<base href="..">

<link rel="import" href="ability/ordereddroppable.html">
<link rel="import" href="ability/helpable.html">
<link rel="import" href="region/region.html">
<link rel="import" href="service/config.html">
<link rel="import" href="third_party/di.html">
<link rel="import" href="trigger/key.html">
<link rel="import" href="utils.html">

<template>
  <style>
    #root {
      outline: var(--border);
      outline-offset: -1px;
      position: relative;
    }

    #content {
      display: flex;
      justify-content: space-between;
      overflow: hidden;
    }

    ::content > *:hover {
      filter: drop-shadow(var(--drop-shadow-layer-1));
    }

    ::content > *:last-child {
      flex-shrink: 0;
    }
  </style>

  <div id="root">
    <div id="content">
      <content></content>
    </div>
  </div>
</template>

<script>
DI
    .prefix('pb')
    .constant('doc', document.currentScript.ownerDocument)
    .with('template', { doc: '=' }, $i => $i.doc.querySelector('template'))
    .bind('region.Hand',
        {
          $registry: '=',
          Config: 'service.=',
          doc: '=',
          Helpable: 'ability.=',
          Key: 'trigger.=',
          OrderedDroppable: 'ability.=',
          Region: 'region.=',
          template: '=',
          Utils: '=',
        },
        $i => {

  const EL_NAME = 'pb-r-hand';



  /**
   * Represents a hand. Like other {{#crossLink region.Region}}{{/crossLink}} elements, the children
   * are considered to be in the hand. A hand allows the user to reorder the child elements,
   * depending on where a child element is dropped.
   *
   * ```html
   * <!-- Hand with two tokens -->
   * <pb-r-deck>
   *   <pb-c-token id="token1">
   *     <div>Token 1</div>
   *   </pb-c-token>
   *   <pb-c-token id="token2">
   *     <div>Token 2</div>
   *   </pb-c-token>
   * </pb-r-deck>
   * ```
   *
   * Supported abilities:
   * - {{#crossLink "ability.OrderedDroppable"}}drop{{/crossLink}}
   *
   * @class region.Hand
   * @extends region.Region
   */
  class Hand extends $i.Region {

    /**
     * Called when the element is created.
     *
     * @method createdCallback
     */
    createdCallback() {
      super.createdCallback();
      this.createShadowRoot()
          .appendChild($i.Utils.activateTemplate($i.template, $i.doc));
    }

    /**
     * The number of elements that users can pick out from the hand.
     *
     * @property pickableChildCount
     * @type number
     * @readonly
     */
    get pickableChildCount() {
      return this.childElementCount;
    }
  }

  /**
   * Node name of the hand.
   * @property NODE_NAME
   * @type string
   * @final
   * @static
   */
  Hand.NODE_NAME = EL_NAME;

  $i.Config.add(
      EL_NAME,
      new $i.Helpable('help'),
      new $i.OrderedDroppable('drop', new $i.Key('d'), true, false /* isVertical */));
  $i.$registry.add(EL_NAME, Hand);

  return Hand;
});
</script>
