<base href="../..">

<link rel="import" href="out/events.html">
<link rel="import" href="out/di.html">
<link rel="import" href="out/pbelement.html">
<link rel="import" href="out/service/preview.html">
<link rel="import" href="out/service/registry.html">
<link rel="import" href="out/utils.html">

<script>
DI
.bind('pb_ui_Preview', (Events, PbElement, service_Preview, $registry, Utils) => {

  /**
   * Class that contains a preview if the mouse enters the parent element. This will display
   * the children element as preview.
   *
   * ```html
   * <!-- Hover over the div to show "DETAILS" -->
   * <div id="hover_over_me">
   *   <pb-u-preview>
   *     <div>DETAILS</div>
   *   </pb-u-preview>
   * </div>
   * ```
   *
   * @class ui.Preview
   * @extends PbElement
   */

  let registered = false;

  const EL_NAME = 'pb-u-preview';

  // Private symbols
  const __onMouseOver__ = Symbol();
  const __onMouseOut__ = Symbol();

  class Preview extends PbElement {

    /**
     * Callback called when the mouse has left the parent element.
     *
     * @method __onMouseOut__
     * @private
     */
    [__onMouseOut__]() {
      service_Preview.previewedEl = null;
    }

    /**
     * Callback called when the mouse has entered the parent element.
     *
     * @method __onMouseOver__
     * @private
     */
    [__onMouseOver__]() {
      service_Preview.previewedEl = this;
    }

    /**
     * Called when the element is created
     *
     * @method createdCallback
     */
    createdCallback() {
      super.createdCallback();
      this.createShadowRoot();
      this.attachedCallback();
    }

    /**
     * Called when the element is attached to the document.
     *
     * @method attachedCallback
     */
    attachedCallback() {
      super.attachedCallback();
      if (this.parentElement) {
        Events.of(this.parentElement, this)
            .listen('mouseenter', this[__onMouseOver__].bind(this))
            .listen('mouseleave', this[__onMouseOut__].bind(this));
      }
    }

    /**
     * Called when the element is detached from the document.
     *
     * @method attachedCallback
     */
    detachedCallback() {
      if (this.parentElement) {
        Events.of(this.parentElement, this).unlisten();
      }
      super.detachedCallback();
    }
  }

  $registry.add(EL_NAME, Preview.prototype);

  return Preview;
});
</script>