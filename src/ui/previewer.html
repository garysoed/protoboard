<base href="../..">

<link rel="import" href="out/events.html">
<link rel="import" href="out/pbelement.html">
<link rel="import" href="out/service/preview.html">
<link rel="import" href="out/utils.html">

<template>
  <div id="root">
    <content></content>
  </div>
</template>

<script>
DI
    .constant('pb$doc', document.currentScript.ownerDocument)
    .with('pb$template', pb$doc => pb$doc.querySelector('template'))
    .bind('pb_ui_Previewer', (Events, PbElement, service_Preview, Utils, pb$doc, pb$template) => {

/**
 * Element that displays the innerHTML of the `pb-u-preview` of element currently being hovered 
 * over. This works in tandem with [[ui.Preview|ui.Preview]] and 
 * [[service.Preview|service.Preview]].
 *
 * @class ui.Previewer
 * @extends PbElement
 */

const EL_NAME = 'pb-u-previewer';

// Private symbols.
const __previewElHandler__ = Symbol();

const __onPreviewElChanged__ = Symbol('onPreviewElChanged');

export default class Previewer extends PbElement {

  /**
   * Called when the preview element has changed.
   *
   * @method __onPreviewElChanged__
   * @private
   */
  [__onPreviewElChanged__]() {
    if (service_Preview.previewedEl) {
      this.innerHTML = service_Preview.previewedEl.innerHTML;
    } else {
      this.innerHTML = '';
    }
  }

  /**
   * Called when the element is created
   *
   * @method createdCallback
   */
  createdCallback() {
    super.createdCallback();
    this.createShadowRoot()
        .appendChild(Utils.activateTemplate(pb$template, pb$doc));

    this.attachedCallback();
  }

  /**
   * Called when the element is attached to the document.
   *
   * @method attachedCallback
   */
  attachedCallback() {
    super.attachedCallback();
    this[__previewElHandler__] = Events.of(service_Preview, this)
        .on(service_Preview.Events.ELEMENT_CHANGED,
            this[__onPreviewElChanged__].bind(this));
  }

  /**
   * Called when the element is detached from the document.
   *
   * @method detachedCallback
   */
  detachedCallback() {
    Events.of(service_Preview, this).off();
    super.detachedCallback();
  }
}

document.registerElement(EL_NAME, {prototype: Previewer.prototype});

return Previewer;
});
</script>