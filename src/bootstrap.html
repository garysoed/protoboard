<base href=".">

<link rel="import" href="third_party/di.html">
<link rel="import" href="service/config.html">
<link rel="import" href="service/registry.html">

<style>
    /* TODO(gs): Move this to myth? */
  @import url(http://fonts.googleapis.com/css?family=Roboto);

  body {
    background-color: var(--color-background);
    color: var(--color-font);
    font-family: var(--font);
    font-size: small;
  }

  p {
    margin-after: .5em;
    margin-before: .5em;
  }

  .pb-trbl-fit,
  * /deep/ .pb-trbl-fit {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
</style>

<script>
DI
    .prefix('pb')
    .bind('$registry', ['service.=', Registry => new Registry()])
    .bind('Bootstrap', [
      '=',
      'service.=',
      '=',
      'region.Bag?',
      'component.Card?',
      'component.Dice?',
      'region.Deck?',
      'ui.Generate?',
      'region.Hand?',
      'ui.Preview?',
      'ui.Previewer?',
      'ui.Shape?',
      'region.Rect?',
      'surface.HexGrid?',
      'surface.RectGrid?',
      'surface.TriangleGrid?',
      'component.Token?',
      ($registry, Config, Utils) => {

  return {
    run(document) {
      Utils
          .watch(() => document.readyState === 'interactive' || document.readyState === 'complete')
          .then(() => {
            $registry.register(document, Config);

            let tags = Utils.
                toArray(document.querySelectorAll(':unresolved')).
                map(el => el.tagName.toLowerCase());
            let tagSet = new Set(tags);
            for (let tag of tagSet) {
              console.warn(`Element ${tag} is unresolved`);
            }
          });
      }
    };
}]);
</script>
