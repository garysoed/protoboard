<base href=".">

<link rel="import" href="third_party/di.html">
<link rel="import" href="service/config.html">
<link rel="import" href="service/registry.html">

<style>
  @import url(http://fonts.googleapis.com/css?family=Roboto);

  body {
    background-color: var(--color-background);
    color: var(--color-font);
    font-family: var(--font);
    font-size: small;
  }

  p {
    margin-after: .5em;
    margin-before: .5em;
  }

  .pb-trbl-fit,
  * /deep/ .pb-trbl-fit {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
</style>

<script>
DIJS
    .prefix('pb')
    .bind('$registry', require => new (require('service.Registry'))())
    .bind('Bootstrap', (require, optional) => {

  const $registry = require('$registry');
  const Config = require('service.Config');
  const Utils = require('Utils');

  optional('component.Card');
  optional('component.Dice');
  optional('component.Token');
  optional('grid.HexGrid');
  optional('grid.RectGrid');
  optional('grid.TriangleGrid');
  optional('region.Bag');
  optional('region.CubeTower');
  optional('region.Deck');
  optional('region.Hand');
  optional('region.Rect');
  optional('service.State');
  optional('ui.Generate');
  optional('ui.Preview');
  optional('ui.Previewer');
  optional('ui.Shape');

  /**
   * Class responsible for bootstrapping the entire app. Call the
   * {{#crossLink "Bootstrap/run:method"}}run{{/crossLink}} after doing all setting up logic.
   *
   * @class Bootstrap
   * @static
   */
  const BOOTSTRAP = {

    /**
     * Runs the bootstrapping logic. All setup logic should occur before calling this.
     *
     * @method run
     * @param {Document} document The DOM document to run the app in.
     * @return {Promise} Promise that will be resolved once all the bootstrapping logic has finished
     *    executing.
     */
    run(document) {
      return Utils
          .watch(() => document.readyState === 'interactive' || document.readyState === 'complete')
          .then(() => {
            $registry.register(document, Config);

            let tags = Utils.
                toArray(document.querySelectorAll(':unresolved')).
                map(el => el.tagName.toLowerCase());
            let tagSet = new Set(tags);
            for (let tag of tagSet) {
              console.warn(`Element ${tag} is unresolved`);
            }
          });
      }
  };
  return BOOTSTRAP;
});
</script>
