<base href="..">

<link rel="import" href="ability/ability.html">
<link rel="import" href="third_party/di.html">
<link rel="import" href="third_party/jquery.html">
<link rel="import" href="service/move.html">

<script>
DI
    .prefix('pb')
    .bind('ability.Pickable',
        {
          $: '/=',
          Ability: 'ability.=',
          Click: 'trigger.=',
          Move: 'service.=',
        },
        $i => {

  // Private symbols.
  const __defaultEnabled__ = Symbol();

  class Pickable extends $i.Ability {

    /**
     * Element with this ability can be picked and dragged around. The element can be dropped on
     * elements with {{#crossLink "ability.Droppable"}}{{/crossLink}} ability.
     *
     * @constructor
     * @class ability.Pickable
     * @param {string} [name=pb-pickable] Name of the ability.
     * @param {trigger.Trigger} [defaultTrigger=trigger.Click] Default trigger for the ability.
     * @param {boolean} [defaultEnabled=true] True iff the ability should be enabled by default.
     * @extends ability.Ability
     */
    constructor(name = 'pb-pickable', defaultTrigger = new $i.Click(), defaultEnabled = true) {
      super(name, defaultTrigger);

      this[__defaultEnabled__] = defaultEnabled;
    }

    /**
     * Sets the default configuration for this ability on the given element.
     *
     * @method init
     * @param {Element} el The element to set the default configuration to.
     */
    init(el) {
      super.init(el);

      if ($i.$(el).attr(this.attrName) === undefined) {
        $i.$(el).attr(this.attrName, this[__defaultEnabled__]);
      }
    }

    /**
     * Picks up the element and makes it follow the mouse cursor.
     *
     * @method doTrigger
     * @param {Element} el Element to be picked up.
     */
    doTrigger(el) {
      $i.Move.add(el);
    }
  }

  return Pickable;
});
</script>