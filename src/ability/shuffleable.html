<base href="../..">

<link rel="import" href="out/ability/ability.html">
<link rel="import" href="out/check.html">
<link rel="import" href="out/di.html">
<link rel="import" href="out/utils.html">

<script>
DI.bind('pb_ability_Shuffleable', (Ability, Check, Click, Utils) => {

  /**
   * Elements with this ability can shuffle its children.
   * 
   * @class ability.Shuffleable
   * @extends ability.Ability
   */

  // Private symbols.
  const __defaultEnabled__ = Symbol();

  class Shuffleable extends Ability {

    /**
     * @constructor
     * @class ability.Shuffleable
     * @param {string} [name='pb-shuffleable'] Name of the ability.
     * @param {ability.Trigger} [defaultTrigger=ability.Click] Default trigger for the ability.
     * @param {boolean} [defaultEnabled=true] True iff the ability should be enabled by default.
     */
    constructor(name = 'pb-shuffleable', defaultTrigger = new Click(), defaultEnabled = true) {
      super(name, defaultTrigger);

      this[__defaultEnabled__] = defaultEnabled;
    }

    /**
     * @override
     */
    init(el) {
      super.init(el);

      if ($(el).attr(this.attrName) === undefined) {
        $(el).attr(this.attrName, this[__defaultEnabled__]);
      }
    }

    /**
     * @override
     */
    trigger(el) {
      if (Check($(el).attr(this.attrName)).isBoolean().orUse(false)) {
        // TODO(gs): Add shuffle animation.
        console.log('shuffling');
        let pairs = Utils.toArray(el.children).map(child => [child, Math.random()]);
        pairs.sort((a, b) => Utils.compare(a[1], b[1]));

        let shuffled = pairs.map(pair => pair[0]);
        shuffled.forEach(shuffledEl => el.appendChild(shuffledEl));
      }
    }
  }

  return Shuffleable;
});
