<html><head><base href=".">

<link rel="import" href="bootstrap.html">
<link rel="import" href="net/inmemoryio.html">
<link rel="import" href="net/session.html">
<link rel="import" href="third_party/di.html">

<script>"use strict";var _toArray=function(n){return Array.isArray(n)?n:Array.from(n)},_createClass=function(){function n(n,r){for(var t in r){var e=r[t];e.configurable=!0,e.value&&(e.writable=!0)}Object.defineProperties(n,r)}return function(r,t,e){return t&&n(r.prototype,t),e&&n(r,e),r}}(),_classCallCheck=function(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")};DIJS.bind("pb.Protoboard.__runner__",function(n){var r=Symbol("gameSyncPromise"),t=Symbol(),e=Symbol(),o=Symbol(),a=function(){function n(o,a){_classCallCheck(this,n),this[r]=a,this[t]=o,this[e]=[]}return _createClass(n,{join:{value:function(n,r){return this[e].push({id:n,state:r}),this}},setup:{value:function(n){return this[o]=n,this}},run:{value:function(){var n=this,a=void 0===arguments[0]?document:arguments[0];return new Promise(function(u,i){DIJS.constant("pb.net.IO",n[t]).run(function(t){var i=t("pb.Bootstrap"),s=t("pb.net.Session"),c=t("pb.service.State"),l=t("pb.service.Template");n[r](t).then(function(r){var t=Promise.resolve(),o=!0,a=!1,u=void 0;try{for(var i,c=n[e][Symbol.iterator]();!(o=(i=c.next()).done);o=!0)!function(){var n=i.value;t=t.then(function(n){return s.join(r,n.id,n.state)}.bind(null,n))}()}catch(l){a=!0,u=l}finally{try{!o&&c["return"]&&c["return"]()}finally{if(a)throw u}}return Promise.all([r,t])}).then(function(n){{var r=_toArray(n),t=r[0];r.slice(1)}return s.start(t).then(function(n){return n.get()})}).then(function(n){return l.addData("pb.playerCount",n.playerCount),l.addData("pb.players",n.players),l.addData("pb.state",n.state),n}).then(function(r){return Promise.all([r,Promise.resolve(n[o]?n[o](t):null)])}).then(function(n){{var r=_toArray(n),t=r[0];r.slice(1)}return Promise.all([t,i.run(a)])}).then(function(n){{var r=_toArray(n),t=r[0];r.slice(1)}c.put("pb_playerCount",t.playerCount)}).then(function(){return u(t)})})})}}}),n}();return a.forNewGame=function(n,r,t){return new a(n,function(n){var e=n("pb.net.Session");return e.create(r,t)})},a.forExistingGame=function(n,r){return new a(n,function(n){var t=n("pb.net.Session");return Promise.resolve(t.get(r))})},a}).bind("pb.Protoboard.__ctor__",function(n){var r=(n("DIJS"),n("pb.net.InMemoryIO")),t=n("pb.Protoboard.__runner__"),e=Symbol(),o=(Symbol(),function(){function n(){_classCallCheck(this,n),this[e]=new r}return _createClass(n,{withIo:{value:function(n){return this[e]=n,this}},forExistingGame:{value:function(n){return t.forExistingGame(this[e],n)}},forNewGame:{value:function(){var n=void 0===arguments[0]?0:arguments[0],r=void 0===arguments[1]?{}:arguments[1];return t.forNewGame(this[e],n,r)}},run:{value:function(){var n=void 0===arguments[0]?document:arguments[0];return this.forNewGame().run(n)}}}),n}());return o}),window.Protoboard=DIJS.run(function(n){var r=n("pb.Protoboard.__ctor__");return new r});</script>
</head><body></body></html>