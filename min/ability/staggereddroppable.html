<html><head><base href="..">

<link rel="import" href="ability/droppable.html">
<link rel="import" href="check.html">
<link rel="import" href="service/move.html">
<link rel="import" href="third_party/chance.html">
<link rel="import" href="third_party/jquery.html">
<link rel="import" href="trigger/key.html">
<link rel="import" href="utils.html">

<script>"use strict";var _createClass=function(){function t(t,r){for(var e in r){var n=r[e];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(t,r)}return function(r,e,n){return e&&t(r.prototype,e),n&&t(r,n),r}}(),_get=function t(r,e,n){var o=Object.getOwnPropertyDescriptor(r,e);if(void 0===o){var a=Object.getPrototypeOf(r);return null===a?void 0:t(a,e,n)}if("value"in o&&o.writable)return o.value;var i=o.get;return void 0===i?void 0:i.call(n)},_inherits=function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(t.__proto__=r)},_classCallCheck=function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")};DIJS.bind("pb.ability.StaggeredDroppable",function(t){var r=t("pb.$"),e=t("pb.Chance"),n=t("pb.Check"),o=t("pb.ability.Droppable"),a=t("pb.trigger.Key"),i=t("pb.service.Move"),u=t("pb.Utils"),c=Symbol(),s="pb-stagger-level",l=function(t){function o(){var t=void 0===arguments[0]?"drop":arguments[0],r=void 0===arguments[1]?new a("d"):arguments[1],e=void 0===arguments[2]?!0:arguments[2],n=void 0===arguments[3]?[1]:arguments[3];_classCallCheck(this,o),_get(Object.getPrototypeOf(o.prototype),"constructor",this).call(this,t,r,e),this[c]=n}return _inherits(o,t),_createClass(o,{init:{value:function(t){void 0===r(t).attr(this.attrChances)&&r(t).attr(this.attrChances,this[c].join(" ")),_get(Object.getPrototypeOf(o.prototype),"init",this).call(this,t)}},updateConfig:{value:function(t){_get(Object.getPrototypeOf(o.prototype),"updateConfig",this).call(this,t);var e=n(r(t).attr(this.attrChances)).isList().orThrows().map(function(t){return n(t).isFloat().orThrows()});e.forEach(function(t){if(0>t||t>1)throw new Error("Invalid probability value: "+t)}),u.toArray(t.querySelectorAll("["+s+"]")).forEach(function(t){var o=n(r(t).attr(s)).isInt().orThrows();o>=e.length&&r(t).attr(s,null)})}},doTrigger:{value:function(t){var o=this,a=i.nextElement;a&&!function(){t.appendChild(a);var i=new Set;i.add(a);for(var c=n(r(t).attr(o.attrChances)).isList().orThrows().map(function(t){return n(t).isFloat().orThrows()}),l=0;l<c.length;l++)!function(n){var o=100*c[n];u.toArray(t.querySelectorAll("["+s+'="'+n+'"]')).forEach(function(t){return i.add(t)});var a=e.binom(i,{likelihood:100-o});a.forEach(function(t){r(t).attr(s,n),i["delete"](t)})}(l);i.forEach(function(t){return r(t).attr(s,null)})}()}},isInStaggerState:{value:function(t){return!Number.isNaN(n(r(t).attr(""+s)).isInt().orUse(0/0))}},attrChances:{get:function(){return""+this.attrName+"-chances"}}}),o}(o);return l});</script>
</head><body></body></html>