<html><head><base href="..">

<link rel="import" href="testbase.html">
<link rel="import" href="third_party/di.html">

<script>"use strict";

DIJS.bind("pb.net.IOTestSuite", function (require) {
  var _ = require("pb._");
  var _M = require("pb.spies.Matchers");
  var expect = require("expect");

  function IOTestSuite(ctor, triggerUpdate) {
    var io = undefined;

    beforeEach(function () {
      io = new ctor();
    });

    describe("triggerUpdate", function () {
      it("should call listener for update", function () {
        var listener = _.spiedFunction();
        io.listen(listener);
        triggerUpdate(io, "path", { a: 1 });
        expect(listener).calledWith("path", { a: 1 }).at.least(1);
      });
    });

    describe("set and get", function () {
      it("should return a promise that is resolved after setting the value", function () {
        return io.set("/path", 2).then(function () {
          return io.get("/path");
        }).then(function (value) {
          expect(value).to.equal(2);
        });
      });
    });

    afterEach(function () {
      _.reset();
    });
  }

  return IOTestSuite;
});</script>
</head><body></body></html>