<html><head><base href="..">

<link rel="import" href="ability/droppable.html">
<link rel="import" href="check.html">
<link rel="import" href="service/move.html">
<link rel="import" href="third_party/chance.html">
<link rel="import" href="third_party/jquery.html">
<link rel="import" href="trigger/key.html">
<link rel="import" href="utils.html">

<script type="text/javascript">"use strict";var _createClass=function(){function t(t,e){for(var r in e){var n=e[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(t,e)}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_get=function t(e,r,n){var o=Object.getOwnPropertyDescriptor(e,r);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,n)}if("value"in o&&o.writable)return o.value;var i=o.get;return void 0===i?void 0:i.call(n)},_inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)},_classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};DI.prefix("pb").bind("ability.StaggeredDroppable",{$:"/=",Chance:"/=",Check:"=",Droppable:"ability.=",Key:"trigger.=",Move:"service.=",Utils:"="},function(t){var e=Symbol(),r="pb-stagger-level",n=function(n){function o(){var r=void 0===arguments[0]?"drop":arguments[0],n=void 0===arguments[1]?new t.Key("d"):arguments[1],a=void 0===arguments[2]?!0:arguments[2],i=void 0===arguments[3]?[1]:arguments[3];_classCallCheck(this,o),_get(Object.getPrototypeOf(o.prototype),"constructor",this).call(this,r,n,a),this[e]=i}return _inherits(o,n),_createClass(o,{init:{value:function(r){void 0===t.$(r).attr(this.attrChances)&&t.$(r).attr(this.attrChances,this[e].join(" ")),_get(Object.getPrototypeOf(o.prototype),"init",this).call(this,r)}},updateConfig:{value:function(e){_get(Object.getPrototypeOf(o.prototype),"updateConfig",this).call(this,e);var n=t.Check(t.$(e).attr(this.attrChances)).isList().orThrows().map(function(e){return t.Check(e).isFloat().orThrows()});n.forEach(function(t){if(0>t||t>1)throw new Error("Invalid probability value: "+t)}),t.Utils.toArray(e.querySelectorAll("["+r+"]")).forEach(function(e){var o=t.Check(t.$(e).attr(r)).isInt().orThrows();o>=n.length&&t.$(e).attr(r,null)})}},doTrigger:{value:function(e){var n=this,o=t.Move.movedElements.values().next().value;o&&!function(){e.appendChild(o);var a=new Set;a.add(o);for(var i=t.Check(t.$(e).attr(n.attrChances)).isList().orThrows().map(function(e){return t.Check(e).isFloat().orThrows()}),c=0;c<i.length;c++)!function(n){var o=100*i[n];t.Utils.toArray(e.querySelectorAll("["+r+'="'+n+'"]')).forEach(function(t){return a.add(t)});var c=t.Chance.binom(a,{likelihood:100-o});c.forEach(function(e){t.$(e).attr(r,n),a["delete"](e)})}(c);a.forEach(function(e){return t.$(e).attr(r,null)})}()}},isInStaggerState:{value:function(e){return!Number.isNaN(t.Check(t.$(e).attr(""+r)).isInt().orUse(0/0))}},attrChances:{get:function(){return""+this.attrName+"-chances"}}}),o}(t.Droppable);return n});</script>
</head><body></body></html>