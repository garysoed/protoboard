<!DOCTYPE html>
<html>
<head>
  <base href="..">
  <title>net.InMemoryIO Unit Tests</title>

  <link rel="import" href="net/inmemoryio.html">
  <link rel="import" href="net/io_testsuite.html">
  <link rel="import" href="testbase.html">
  <link rel="import" href="third_party/di.html">
</head>
<body>
<script>
DIJS
.run(require => {
  const InMemoryIO = require('pb.net.InMemoryIO');
  const IOTestSuite = require('pb.net.IOTestSuite');
  const j = require('jasmine');
  const t = require('pb.t');

  describe('net.InMemoryIO', () => {
    IOTestSuite(
        InMemoryIO,
        (io, path, newData) => {
          t.getPrivateMethod(io, 'triggerUpdate')(path, newData);
        });

    let io;

    beforeEach(() => {
      io = new InMemoryIO();
    });

    describe('set', () => {
      it('should trigger update after setting the value', done => {
        let listener = j.createSpy('listener');
        io.listen(listener);
        io.set('/path', 3)
            .then(() => {
              expect(listener).toHaveBeenCalledWith('/path', 3);
            })
            .then(done);
      });
    });
  });
});
</script>
</body>
