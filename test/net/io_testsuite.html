<base href="..">

<link rel="import" href="testbase.html">
<link rel="import" href="third_party/di.html">

<script>
DIJS
.bind('pb.net.IOTestSuite', require => {

  const j = require('jasmine');

  function IOTestSuite(ctor, triggerUpdate) {
    let io;

    beforeEach(() => {
      io = new ctor();
    });

    describe('triggerUpdate', () => {
      it('should call listener for update', () => {
        let listener = j.createSpy('listener');
        io.listen(listener);
        triggerUpdate(io, 'path', { a: 1 });
        expect(listener).toHaveBeenCalledWith('path', { a: 1 });
      });
    });

    describe('set and get', () => {
      it('should return a promise that is resolved after setting the value', done => {
        io.set('/path', 2)
            .then(() => {
              return io.get('/path');
            })
            .then(value => {
              expect(value).toEqual(2);
            })
            .then(done);
      });
    });
  }

  return IOTestSuite;
});
</script>
