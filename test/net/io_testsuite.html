<base href="..">

<link rel="import" href="testbase.html">
<link rel="import" href="third_party/di.html">

<script>
DIJS
.bind('pb.net.IOTestSuite', require => {
  const _ = require('spies.Spies');
  const _M = require('spies.Matchers');
  const expect = require('chai.expect');

  function IOTestSuite(ctor, triggerUpdate) {
    let io;

    beforeEach(() => {
      io = new ctor();
    });

    describe('triggerUpdate', () => {
      it('should call listener for update', () => {
        let listener = _.spiedFunction();
        io.listen(listener);
        triggerUpdate(io, 'path', { a: 1 });
        expect(listener).calledWith('path', { a: 1 }).at.least(1);
      });
    });

    describe('set and get', () => {
      it('should return a promise that is resolved after setting the value', () => {
        return io.set('/path', 2)
            .then(() => {
              return io.get('/path');
            })
            .then(value => {
              expect(value).to.equal(2);
            });
      });
    });

    afterEach(() => {
      _.reset();
    });
  }

  return IOTestSuite;
});
</script>
