<!DOCTYPE html>
<html>
<head>
  <base href="../..">
  <title>Abilities Unit Tests</title>
  <link rel="import" href="test/testbase.html">
</head>
<body>
  <script>
    'use strict';

    (function() {
      var expect = chai.expect;
      var _ = spies.Spies;

      var doc = document.currentScript.ownerDocument;

      describe('Abilities', function() {
        describe('#config', function() {
          it('should extend all the expected functions', function() {
            var Ctor = function() {};
            var Ability = {
              setDefaultValue: _.spiedFunction(),
              attributeChangedCallback: _.spiedFunction(),
              attachedCallback: _.spiedFunction(),
              detachedCallback: _.spiedFunction()
            };
            var defaultValue = {a: 1, b: 2};

            pb.ability.Abilities.config(
                Ctor, 
                new Map([
                  [Ability, defaultValue]
                ]));

            var ctor = new Ctor();
            ctor.createdCallback();
            expect(Ability.setDefaultValue).calledWith(defaultValue).at.least(1);

            ctor.attributeChangedCallback('attr', 'oldValue', 'newValue');
            expect(Ability.attributeChangedCallback)
                .calledWith('attr', 'oldValue', 'newValue').at.least(1);

            ctor.attachedCallback();
            expect(Ability.attachedCallback).calledWith().at.least(1);

            ctor.detachedCallback();
            expect(Ability.detachedCallback).calledWith().at.least(1);
          });
        });

        afterEach(function(done) {
          _.reset();
          done();
        });
      });
    })();
  </script>
</body>