<!DOCTYPE html>
<html>
<head>
  <base href="..">
  <title>Droppable Unit Tests</title>

  <link rel="import" href="testbase.html">

  <link rel="import" href="ability/droppable.html">
  <link rel="import" href="service/move.html">
  <link rel="import" href="service/registry.html">
  <link rel="import" href="third_party/di.html">
  <link rel="import" href="third_party/events.html">
  <link rel="import" href="third_party/jquery.html">
  <link rel="import" href="utils.html">
</head>
<body>
  <script>
    DI
        .prefix('pb')
        .constant('service.Move', {
          nextElement: null
        })
        .with('$registry', { Registry: 'service.=' }, $i => new $i.Registry())
        .constant('doc', document.currentScript.ownerDocument)
        .run(
            {
              expect: '/=',
              doc: '=',
              $: '/=',
              Droppable: 'ability.=',
              Move: 'service.=',
              Utils: '='
            },
            $i => {

      describe('Droppable', () => {
        let el;

        beforeEach(done => {
          el = $i.doc.createElement('div');
          done();
        });

        describe('#init', () => {
          it('should set the default value if the attribute is not set', () => {
            let droppable = new $i.Droppable(undefined, undefined, false);
            droppable.init(el);
            $i.expect($i.$(el).attr(droppable.attrName)).to.equal('false');
          });
          it('should not set the default value if the attribute is set', () => {
            let value = 'value';
            let droppable = new $i.Droppable();
            $i.$(el).attr(droppable.attrName, value);
            droppable.init(el);
            $i.expect($i.$(el).attr(droppable.attrName)).to.equal(value);
          });
        });

        describe('#trigger', () => {
          let droppable;

          it('should add the moved elements if enabled', () => {
            let child1 = $i.doc.createElement('div');

            droppable = new $i.Droppable(undefined, undefined, true);
            droppable.init(el);

            $i.Move.nextElement = child1;

            droppable.trigger(el);

            $i.expect($i.Utils.toArray(el.children)).to.eql([child1]);
          });
          it('should do nothing if not enabled', () => {
            let child1 = $i.doc.createElement('div');

            droppable = new $i.Droppable(undefined, undefined, false);
            droppable.init(el);

            $i.Move.nextElement = child1;

            droppable.trigger(el);

            $i.expect(el.children.length).to.equal(0);
          });
        });
      });
    });
  </script>
</body>
