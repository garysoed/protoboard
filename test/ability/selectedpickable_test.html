<!DOCTYPE html>
<html>
<head>
  <base href="..">
  <title>ability.SelectedPickable Unit Tests</title>

  <link rel="import" href="ability/selectedpickable.html">
  <link rel="import" href="ui/moveservice.html">
  <link rel="import" href="ui/registryservice.html">
  <link rel="import" href="testbase.html">
  <link rel="import" href="third_party/chance.html">
  <link rel="import" href="third_party/di.html">
  <link rel="import" href="third_party/jquery.html">
</head>
<body>
<script>
DIJS
.constant('doc', document.currentScript.ownerDocument)
.with('pb.$registry', require => new (require('pb.ui.RegistryService'))())
.run(require => {

  const $ = require('pb.JQuery');
  const doc = require('doc');
  const j = require('jasmine');
  const Move = require('pb.ui.MoveService');
  const SelectedPickable = require('pb.ability.SelectedPickable');

  describe('ability.SelectedPickable', () => {
    describe('#trigger', () => {
      let pickable;
      let selectFn;
      let parent;

      beforeEach(() => {
        selectFn = j.createSpy('selectFn');
        pickable = new SelectedPickable(selectFn);
        parent = doc.createElement('div');
        pickable.init(parent);
      });

      it('should add the element returned by the selection function to the move service', () => {
        let el = doc.createElement('div');
        selectFn.and.returnValue(el);
        spyOn(Move, 'add').and.returnValue();

        pickable.trigger(parent);

        expect(Move.add).toHaveBeenCalledWith(el);
        expect(selectFn).toHaveBeenCalledWith(parent);
      });
      it('should do nothing if the selection function returned null', () => {
        selectFn.and.returnValue(null);
        spyOn(Move, 'add').and.returnValue();

        pickable.trigger(parent);

        expect(Move.add).not.toHaveBeenCalled();
        expect(selectFn).toHaveBeenCalledWith(parent);
      });
    });
  });
});
</script>
</body>
