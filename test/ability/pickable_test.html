<!DOCTYPE html>
<html>
<head>
  <base href="..">
  <title>ability.Pickable Unit Tests</title>

  <link rel="import" href="ability/pickable.html">
  <link rel="import" href="third_party/di.html">
  <link rel="import" href="testbase.html">
</head>
<body>
  <script>
  DI
      .prefix('pb')
      .with('$registry', { Registry: 'service.=' }, $i => new $i.Registry())
      .constant('service.Move', { add() {} })
      .constant('doc', document.currentScript.ownerDocument)
      .run(
          {
            expect: '/=',
            _: '/=',
            doc: '=',
            Move: 'service.=',
            Pickable: 'ability.='
          },
          $i => {

  describe('ability.Pickable', () => {
    let el;

    beforeEach(done => {
      el = $i.doc.createElement('div');
      done();
    });

    describe('#init', () => {
      it('should set the default value if the attribute is not set', () => {
        let pickable = new $i.Pickable(undefined, undefined, true);
        pickable.init(el);
        $i.expect($(el).attr(pickable.attrName)).to.be.equal('true');
      });
      it('should not set the default value if the attribute is set', () => {
        let value = 'value';
        let pickable = new $i.Pickable(undefined, undefined, true);
        $(el).attr(pickable.attrName, value);
        pickable.init(el);
        $i.expect($(el).attr(pickable.attrName)).to.equal(value);
      });
    });

    describe('#trigger', () => {
      it('should add the element to Move if enabled', () => {
        let pickable = new $i.Pickable(undefined, undefined, true);
        pickable.init(el);

        $i._.spy($i.Move, 'add');

        pickable.trigger(el);

        $i.expect($i.Move.add).calledWith(el).at.least(1);
      });
      it('should do nothing if not enabled', () => {
        let pickable = new $i.Pickable(undefined, undefined, false);
        pickable.init(el);

        $i._.spy($i.Move, 'add');

        pickable.trigger(el, {});

        $i.expect($i.Move.add).called().to.equal(0);
      });
    });

    afterEach(done => {
      $i._.reset();
      done();
    });
  });
  });
  </script>
</body>