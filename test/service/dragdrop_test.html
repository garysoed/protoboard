<!DOCTYPE html>
<html>
<head>
  <base href="../..">
  <title>DragDrop Unit Tests</title>
  <link rel="import" href="out/testbase.html">

  <link rel="import" href="out/inject.html">
  <link rel="import" href="out/service/dragdrop.html">
</head>
<body>
  <script>
  Inject.inject((expect, _, DragDrop) => {

  describe('DragDrop', () => {
    describe('#dragStart', () => {
      it('should set the lastDraggedEl and offset and trigger an event', () => {
        let draggedEl = {};
        let handler = _.spiedFunction();

        $(DragDrop).on(DragDrop.Events.LAST_DRAGGED_EL_CHANGED, handler);
        DragDrop.dragStart(draggedEl, 1, 2);

        expect(DragDrop.lastDraggedEl).to.be.equal(draggedEl);
        expect(DragDrop.offsetX).to.be.equal(1);
        expect(DragDrop.offsetY).to.be.equal(2);
        expect(handler).called().at.least(1);
      });
    });

    describe('#dragEnd', () => {
      it('should set the lastDraggedEl to null and offset and trigger an event', () => {
        DragDrop.dragStart({}, 1, 2);

        let handler = _.spiedFunction();
        $(DragDrop).on(DragDrop.Events.LAST_DRAGGED_EL_CHANGED, handler);
        DragDrop.dragEnd();

        expect(DragDrop.lastDraggedEl).to.be.null();
        expect(DragDrop.offsetX).to.be.undefined();
        expect(DragDrop.offsetY).to.be.undefined();
        expect(handler).called().at.least(1);
      });
    });

    afterEach(done => {
      _.reset();
      done();
    });
  });
  });
  </script>
</body>