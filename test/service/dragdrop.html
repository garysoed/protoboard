<!DOCTYPE html>
<html>
<head>
  <base href="../..">
  <title>DragDrop Unit Tests</title>
  <link rel="import" href="test/testbase.html">
  <link rel="import" href="main.html">
</head>
<body>
  <script>
    'use strict';

    (function() {
      var DragDrop = pb.service.DragDrop;
      var expect = chai.expect;
      var _ = spies.Spies;

      describe('DragDrop', function() {
        describe('#dragStart', function() {
          it('should set the lastDraggedEl and offset and trigger an event', function() {
            var draggedEl = {};
            var handler = _.spiedFunction();

            $(DragDrop).on(DragDrop.Events.LAST_DRAGGED_EL_CHANGED, handler);
            DragDrop.dragStart(draggedEl, 1, 2);

            expect(DragDrop.lastDraggedEl).to.be.equal(draggedEl);
            expect(DragDrop.offsetX).to.be.equal(1);
            expect(DragDrop.offsetY).to.be.equal(2);
            expect(handler).called().at.least(1);
          });
        });

        describe('#dragEnd', function() {
          it('should set the lastDraggedEl to null and offset and trigger an event', function() {
            DragDrop.dragStart({}, 1, 2);

            var handler = _.spiedFunction();
            $(DragDrop).on(DragDrop.Events.LAST_DRAGGED_EL_CHANGED, handler);
            DragDrop.dragEnd();

            expect(DragDrop.lastDraggedEl).to.be.null();
            expect(DragDrop.offsetX).to.be.undefined();
            expect(DragDrop.offsetY).to.be.undefined();
            expect(handler).called().at.least(1);
          });
        });

        afterEach(function(done) {
          _.reset();
          done();
        });
      });
    })();
  </script>
</body>