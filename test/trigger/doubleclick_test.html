<!DOCTYPE html>
<html>
<head>
  <base href="..">
  <title>DoubleClick Unit Tests</title>
  <link rel="import" href="third_party/di.html">
  <link rel="import" href="testbase.html">
  <link rel="import" href="trigger/doubleclick.html">
</head>
<body>
  <script>
  DI
      .prefix('pb')
      .constant('doc', document.currentScript.ownerDocument)
      .with('Events', { t: '=' }, $i => $i.t.createFakeEvents())
      .run(
          {
            _: '/=',
            _M: '/=',
            doc: '=',
            expect: '/=',
            t: '=',
            DoubleClick: 'trigger.=',
            Events: '='
          },
          $i => {

    describe('DoubleClick', () => {
      let doubleClick;

      beforeEach(done => {
        doubleClick = new $i.DoubleClick();
        done();
      });

      describe('#on', () => {
        it('should register singletap on hammer', () => {
          let ability = $i.t.createFakeAbility('test');
          let element = $i.doc.createElement('div');

          doubleClick.on(element, ability);

          $i.expect($i.Events.of).calledWith(element, doubleClick).at.least(1);
          let handlerCaptor = $i._M.isA(Function);
          $i.expect($i.Events.on).calledWith('hammer', 'doubletap', handlerCaptor).at.least(1);

          handlerCaptor.matchingArgs[0]();
          $i.expect(ability.trigger).calledWith(element).at.least(1);
        });
      });

      describe('#off', () => {
        it('should unregister doubletap on hammer', () => {
          let element = $i.doc.createElement('div');

          doubleClick.off(element);

          $i.expect($i.Events.of).calledWith(element, doubleClick).at.least(1);
          $i.expect($i.Events.off).calledWith('hammer', 'doubletap').at.least(1);
        });
      });

      afterEach(done => {
        $i._.reset();
        done();
      });
    });
  });
  </script>
</body>
