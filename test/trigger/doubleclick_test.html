<!DOCTYPE html>
<html>
<head>
  <base href="..">
  <title>DoubleClick Unit Tests</title>
  <link rel="import" href="third_party/di.html">
  <link rel="import" href="testbase.html">
  <link rel="import" href="testing/fakeability.html">
  <link rel="import" href="testing/fakeevents.html">
  <link rel="import" href="trigger/doubleclick.html">
</head>
<body>
<script>
DIJS
.constant('doc', document.currentScript.ownerDocument)
.with('pb.Events', require => {
  const FakeEvents = require('pb.testing.FakeEvents');
  return new FakeEvents();
})
.run(require => {

  const doc = require('doc');
  const DoubleClick = require('pb.trigger.DoubleClick');
  const Events = require('pb.Events');
  const FakeAbility = require('pb.testing.FakeAbility');
  const j = require('jasmine');

  describe('DoubleClick', () => {
    let doubleClick;

    beforeEach(() => {
      doubleClick = new DoubleClick();
    });

    describe('#on', () => {
      it('should register singletap on hammer', () => {
        let ability = new FakeAbility('test');
        let element = doc.createElement('div');

        spyOn(ability, 'trigger');
        spyOn(Events, 'of').and.callThrough();
        spyOn(Events, 'on').and.callThrough();

        doubleClick.on(element, ability);

        expect(Events.of).toHaveBeenCalledWith(element, doubleClick);
        expect(Events.on).toHaveBeenCalledWith('hammer', 'doubletap', j.any(Function));

        Events.on.calls.argsFor(0)[2]();
        expect(ability.trigger).toHaveBeenCalledWith(element);
      });
    });

    describe('#off', () => {
      it('should unregister doubletap on hammer', () => {
        let element = doc.createElement('div');

        spyOn(Events, 'of').and.callThrough();
        spyOn(Events, 'off').and.callThrough();

        doubleClick.off(element);

        expect(Events.of).toHaveBeenCalledWith(element, doubleClick);
        expect(Events.off).toHaveBeenCalledWith('hammer', 'doubletap');
      });
    });
  });
});
</script>
</body>
