<!DOCTYPE html>
<html>
<head>
  <base href="..">
  <title>DoubleClick Unit Tests</title>
  <link rel="import" href="third_party/di.html">
  <link rel="import" href="testbase.html">
  <link rel="import" href="testing/fakeability.html">
  <link rel="import" href="testing/fakeevents.html">
  <link rel="import" href="trigger/doubleclick.html">
</head>
<body>
<script>
DIJS
.constant('doc', document.currentScript.ownerDocument)
.with('pb.Events', require => {
  const FakeEvents = require('pb.testing.FakeEvents');
  return new FakeEvents();
})
.run(require => {

  const _ = require('spies.Spies');
  const _M = require('spies.Matchers');

  const doc = require('doc');
  const DoubleClick = require('pb.trigger.DoubleClick');
  const Events = require('pb.Events');
  const expect = require('chai.expect');
  const FakeAbility = require('pb.testing.FakeAbility');

  describe('DoubleClick', () => {
    let doubleClick;

    beforeEach(() => {
      doubleClick = new DoubleClick();
    });

    describe('#on', () => {
      it('should register singletap on hammer', () => {
        let ability = new FakeAbility('test');
        let element = doc.createElement('div');

        _.spy(ability, 'trigger');
        _.spy(Events, 'of');
        _.spy(Events, 'on');

        doubleClick.on(element, ability);

        expect(Events.of).calledWith(element, doubleClick).at.least(1);
        let handlerCaptor = _M.isA(Function);
        expect(Events.on).calledWith('hammer', 'doubletap', handlerCaptor).at.least(1);

        handlerCaptor.matchingArgs[0]();
        expect(ability.trigger).calledWith(element).at.least(1);
      });
    });

    describe('#off', () => {
      it('should unregister doubletap on hammer', () => {
        let element = doc.createElement('div');

        _.spy(Events, 'of');
        _.spy(Events, 'off');

        doubleClick.off(element);

        expect(Events.of).calledWith(element, doubleClick).at.least(1);
        expect(Events.off).calledWith('hammer', 'doubletap').at.least(1);
      });
    });

    afterEach(() => {
      _.reset();
    });
  });
});
</script>
</body>
