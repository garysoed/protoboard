<!DOCTYPE html>
<html>
<head>
  <base href="..">
  <title>trigger.Triggers Unit Tests</title>

  <link rel="import" href="testbase.html">
  <link rel="import" href="third_party/di.html">
  <link rel="import" href="third_party/spies.html">
  <link rel="import" href="trigger/triggers.html">
</head>
<body>
<script>
DIJS
.run(require => {

  const j = require('jasmine');
  const Triggers = require('pb.trigger.Triggers.__ctor__');

  describe('trigger.Triggers', () => {
    let triggers;

    beforeEach(() => {
      triggers = new Triggers();
    });

    describe('#parse', () => {
      it('should be able to parse a registered trigger', () => {
        let result = 5;
        let parser = j.createSpy('parser').and.returnValue(result);
        let string = 'triggerString';
        triggers.register(parser);
        expect(triggers.parse(string)).toEqual(result);
        expect(parser).toHaveBeenCalledWith(string);
      });
      it('should return the first registered matching trigger', () => {
        let result = 6;
        let parser1 = j.createSpy('parser1').and.returnValue(result);
        let parser2 = j.createSpy('parser2').and.returnValue(result);
        let string = 'triggerString';
        triggers.register(parser1);
        triggers.register(parser2);
        expect(triggers.parse(string)).toEqual(result);
        expect(parser1).toHaveBeenCalledWith(string);
        expect(parser2).not.toHaveBeenCalled();
      });
      it('should throw an error if no trigger is found', () => {
        let string = 'triggerString';
        expect(() => triggers.parse(string)).toThrowError(new RegExp(string));
      });
    });
  });
});
</script>
</body>
