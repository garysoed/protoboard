<!DOCTYPE html>
<html>
<head>
  <base href="..">
  <title>trigger.Triggers Unit Tests</title>

  <link rel="import" href="testbase.html">
  <link rel="import" href="third_party/di.html">
  <link rel="import" href="third_party/spies.html">
  <link rel="import" href="trigger/triggers.html">
</head>
<body>
  <script>
  DI
      .prefix('pb')
      .constant('doc', document.currentScript.ownerDocument)
      .run(
          {
            _: '/=',
            expect: '/=',
            Triggers: 'trigger.=',
          },
          $i => {
    describe('trigger.Triggers', () => {
      describe('#parse', () => {
        it('should be able to parse a registered trigger', () => {
          let result = 5;
          let parser = $i._.spiedFunction().overrideReturn(result);
          let string = 'triggerString';
          $i.Triggers.register(parser);
          $i.expect($i.Triggers.parse(string)).to.equal(result);
          $i.expect(parser).calledWith(string).at.least(1);
        });
        it('should return the first registered matching trigger', () => {
          let result = 6;
          let parser1 = $i._.spiedFunction().overrideReturn(result);
          let parser2 = $i._.spiedFunction().overrideReturn(result);
          let string = 'triggerString';
          $i.Triggers.register(parser1);
          $i.Triggers.register(parser2);
          $i.expect($i.Triggers.parse(string)).to.equal(result);
          $i.expect(parser1).calledWith(string).at.least(1);
          $i.expect(parser2).called().to.equal(0);
        });
        it('should throw an error if no trigger is found', () => {
          let string = 'triggerString';
          $i.expect(() => $i.Triggers.parse(string)).to.throw(string);
        });
      });

      afterEach(done => {
        $i.Triggers.clear();
        $i._.reset();
        done();
      });
    });
  });
  </script>
</body>
