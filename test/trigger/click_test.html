<!DOCTYPE html>
<html>
<head>
  <base href="..">
  <title>Click Unit Tests</title>
  <link rel="import" href="third_party/di.html">
  <link rel="import" href="testbase.html">
  <link rel="import" href="testing/fakeability.html">
  <link rel="import" href="testing/fakeevents.html">
  <link rel="import" href="trigger/click.html">
</head>
<body>
<script>
DIJS
.constant('doc', document.currentScript.ownerDocument)
.with('pb.Events', require => {
  const FakeEvents = require('pb.testing.FakeEvents');
  return new FakeEvents();
})
.run(require => {

  const Click = require('pb.trigger.Click');
  const doc = require('doc');
  const Events = require('pb.Events');
  const FakeAbility = require('pb.testing.FakeAbility');
  const j = require('jasmine');
  const t = require('pb.t');

  describe('trigger.Click', () => {
    let click;

    beforeEach(() => {
      click = new Click();
      spyOn(Events, 'of').and.callThrough();
      spyOn(Events, 'on').and.callThrough();
      spyOn(Events, 'off').and.callThrough();
    });

    describe('#on', () => {
      it('should register singletap on hammer', () => {
        let ability = new FakeAbility('test');
        let element = doc.createElement('div');

        spyOn(ability, 'trigger');

        click.on(element, ability);

        expect(Events.of).toHaveBeenCalledWith(element, click);
        expect(Events.on).toHaveBeenCalledWith('hammer', 'singletap', j.any(Function));

        Events.on.calls.argsFor(0)[2]();
        expect(ability.trigger).toHaveBeenCalledWith(element);
      });
    });

    describe('#off', () => {
      it('should unregister singletap on hammer', () => {
        let element = doc.createElement('div');

        click.off(element);

        expect(Events.of).toHaveBeenCalledWith(element, click);
        expect(Events.off).toHaveBeenCalledWith('hammer', 'singletap');
      });
    });
  });
});
</script>
</body>
