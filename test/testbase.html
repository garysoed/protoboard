<base href=".">

<!-- <script src="../node_modules/mock-promises/lib/mock-promises.js"></script> -->

<link rel="import" href="testutils.html">
<link rel="import" href="testing/jasminehelpers.html">
<link rel="import" href="third_party/di.html">

<script>
DIJS.bind('jasmine', () => jasmine);

let jasmineEnv = jasmine.getEnv();

window.it = function(description, runner, timeout) {
  if (runner.length > 0) {
    jasmineEnv.it(description, runner, timeout);
  } else {
    jasmineEnv.it(description, done => {
      let rv = runner();
      if (rv instanceof Promise) {
        rv
            .then(done)
            .catch(done.fail);
      } else {
        done();
      }
    }, timeout);
  }
};

window.fit = function(description, runner, timeout) {
  if (runner.length > 0) {
    jasmineEnv.fit(description, runner, timeout);
  } else {
    jasmineEnv.fit(description, done => {
      let rv = runner();
      if (rv instanceof Promise) {
        rv
            .then(done)
            .catch(done.fail);
      } else {
        done();
      }
    }, timeout);
  }
};

window.beforeEach = function(runner, timeout) {
  if (runner.length > 0) {
    jasmineEnv.beforeEach(runner, timeout);
  } else {
    jasmineEnv.beforeEach(done => {
      let rv = runner();
      if (rv instanceof Promise) {
        rv
            .then(done)
            .catch(done.fail);
      } else {
        done();
      }
    }, timeout);
  }
};


beforeEach(() => {
  jasmine.addMatchers(jasmine.matchers);
});

</script>
