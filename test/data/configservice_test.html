<!DOCTYPE html>
<html>
<head>
  <base href="..">
  <title>data.ConfigService Unit Tests</title>

  <link rel="import" href="testbase.html">
  <link rel="import" href="testing/fakeability.html">
  <link rel="import" href="testing/faketrigger.html">
  <link rel="import" href="third_party/di.html">
</head>
<body>
<script>
DIJS
.run(require => {
  const Config = require('pb.data.ConfigService.__ctor__');
  const FakeAbility = require('pb.testing.FakeAbility');
  const FakeTrigger = require('pb.testing.FakeTrigger');

  describe('data.ConfigService', () => {
    describe('setDefaultTrigger', () => {
      let elementA;
      let abilityA;
      let abilityB;

      let elementC;
      let abilityA2;

      let configService;

      beforeEach(() => {
        elementA = 'element-A';
        abilityA = new FakeAbility('abilityA');
        abilityB = new FakeAbility('abilityB');
        elementC = 'element-C';
        abilityA2 = new FakeAbility('abilityA');

        configService = new Config();
        configService
            .add(elementA, abilityA, abilityB)
            .add(elementC, abilityA2);
      });

      it('should set trigger of abilities with the given name for the given element name', () => {
        let triggerB = abilityB.defaultTrigger;
        let triggerA2 = abilityA2.defaultTrigger;

        let newTrigger = new FakeTrigger('newTrigger');
        configService.setDefaultTrigger(newTrigger, abilityA.attrName, elementA);

        expect(abilityA.defaultTrigger).toEqual(newTrigger);
        expect(abilityB.defaultTrigger).toEqual(triggerB);
        expect(abilityA2.defaultTrigger).toEqual(triggerA2);
      });
      it('should set trigger of abilities with the given name for all elements', () => {
        let newTrigger = new FakeTrigger('newTrigger');
        let triggerB = abilityB.defaultTrigger;

        configService.setDefaultTrigger(newTrigger, abilityA.attrName);
        expect(abilityA.defaultTrigger).toEqual(newTrigger);
        expect(abilityB.defaultTrigger).toEqual(triggerB);
        expect(abilityA2.defaultTrigger).toEqual(newTrigger);
      });
    });
  });
});
</script>
</body>
