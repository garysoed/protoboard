<!DOCTYPE html>
<html>
<head>
  <base href="..">
  <title>ui.Preview Unit Tests</title>
  <link rel="import" href="testbase.html">

  <link rel="import" href="third_party/di.html">
  <link rel="import" href="data/configservice.html">
  <link rel="import" href="ui/registryservice.html">
  <link rel="import" href="ui/preview.html">
</head>
<body>
<script>
DIJS
.with('pb.$registry', require => new (require('pb.ui.RegistryService'))())
.constant('doc', document.currentScript.ownerDocument)
.run(require => {

  const $registry = require('pb.$registry');

  const Config = require('pb.data.ConfigService');
  const doc = require('doc');
  const j = require('jasmine');
  const Preview = require('pb.ui.Preview');

  describe('ui.Preview', () => {
    let previewEl;

    beforeEach(() => {
      previewEl = doc.createElement('div');
      Object.setPrototypeOf(previewEl, Preview.prototype);
    });

    describe('#attachedCallback', () => {
      it('should listen to mouse enter and leave on parent element', () => {
        let parent = doc.createElement('div');
        parent.appendChild(previewEl);

        spyOn(parent, 'addEventListener');

        previewEl.attachedCallback();

        expect(parent.addEventListener).toHaveBeenCalledWith('mouseenter', j.any(Function));
        expect(parent.addEventListener).toHaveBeenCalledWith('mouseleave', j.any(Function));
      });
      it('should not crash if there are no parent elements', () => {
        previewEl.attachedCallback();
      });
    });

    describe('#detachedCallback', () => {
      it('should stop listening to mouse enter and leave from parent element', () => {
        let parent = doc.createElement('div');
        parent.appendChild(previewEl);

        spyOn(parent, 'addEventListener');
        spyOn(parent, 'removeEventListener');

        previewEl.attachedCallback();

        expect(parent.addEventListener).toHaveBeenCalledWith('mouseenter', j.any(Function));
        expect(parent.addEventListener).toHaveBeenCalledWith('mouseleave', j.any(Function));

        previewEl.detachedCallback();
        expect(parent.removeEventListener).toHaveBeenCalledWith(
            'mouseenter',
            parent.addEventListener.calls.argsFor(0)[1]);
        expect(parent.removeEventListener).toHaveBeenCalledWith(
            'mouseleave',
            parent.addEventListener.calls.argsFor(1)[1]);
      });
      it('should not crash if there are no parent elements', () => {
        previewEl.detachedCallback();
      });
    });
  });
});
</script>
</body>
