<!DOCTYPE html>
<html>
<head>
  <base href="..">
  <title>ui.Shape Unit Tests</title>

  <link rel="import" href="testbase.html">
  <link rel="import" href="testing/fakemutationobserver.html">
  <link rel="import" href="testutils.html">
  <link rel="import" href="third_party/di.html">
  <link rel="import" href="ui/shape.html">
</head>
<body>
<script>
DIJS
.constant('doc', document.currentScript.ownerDocument)
.with('MutationObserver', require => require('pb.testing.FakeMutationObserver'))
.with('pb.$registry', require => new (require('pb.ui.RegistryService'))())
.run(require => {

  const $ = require('pb.JQuery');
  const doc = require('doc');
  const FakeMutationObserver = require('MutationObserver');
  const Shape = require('pb.ui.Shape');

  describe('ui.Shape', () => {
    let el;

    beforeEach(() => {
      el = doc.createElement('div');
      Object.setPrototypeOf(el, Shape.prototype);
    });

    it('should initialize the color from the attribute on creation', () => {
      $(el).attr('color', 'rgb(255, 0, 0)');
      $(el).attr('shape', 'circle');
      el.createdCallback();

      expect(el.shadowRoot.querySelector('.pb-shape').style.fill).toEqual('rgb(255, 0, 0)');
    });
    it('should react to changes to the color attribute', () => {
      $(el).attr('shape', 'circle');
      el.createdCallback();

      $(el).attr('color', 'rgb(255, 0, 0)');
      FakeMutationObserver.lastInstance.handler([{
        type: 'attributes',
        attributeName: 'color'
      }]);

      expect(el.shadowRoot.querySelector('.pb-shape').style.fill).toEqual('rgb(255, 0, 0)');
    });
    it('should throw error if the shape is not handled', () => {
      expect(() => el.createdCallback()).toThrowError(/Unrecognized shape/);
    });
  });
});
</script>
</body>
