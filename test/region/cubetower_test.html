<!DOCTYPE html>
<html>
<head>
  <base href="..">
  <title>region.CubeTower Unit Tests</title>

  <link rel="import" href="region/cubetower.html">
  <link rel="import" href="service/config.html">
  <link rel="import" href="service/move.html">
  <link rel="import" href="testbase.html">
  <link rel="import" href="third_party/chance.html">
  <link rel="import" href="third_party/di.html">
  <link rel="import" href="utils.html">
</head>
<body>
  <script>
  DI
      .prefix('pb')
      .with('$registry', { Registry: 'service.=' }, $i => new $i.Registry())
      .constant('doc', document.currentScript.ownerDocument)
      .constant('service.Move', {
        movedElements: []
      })
      .constant('Chance', {
        binom() { }
      })
      .run(
          {
            $: '/=',
            $registry: '=',
            _: '/=',
            doc: '=',
            expect: '/=',
            Chance: '/=',
            Config: 'service.=',
            CubeTower: 'region.=',
            Move: 'service.=',
            Utils: '='
          },
          $i => {

  const Droppable = $i.CubeTower.TowerDroppable;

  describe('region.CubeTower', () => {
    before(() => {
      $i.$registry.register($i.doc, $i.Config);
    });

    describe('get pickableChildCount', () => {
      it('should return the correct number of child count', () => {
        let tower = $i.doc.createElement('pb-r-cubetower');
        Object.setPrototypeOf(tower, $i.CubeTower.prototype);

        let stuckEl = $i.doc.createElement('div');
        $i.$(stuckEl).attr('pb-stagger-level', 1);
        tower.appendChild(stuckEl);
        tower.appendChild($i.doc.createElement('div'));
        tower.appendChild($i.doc.createElement('div'));

        $i.expect(tower.pickableChildCount).to.equal(2);
      });
    });

    afterEach(done => {
      $i.Move.movedElements.splice(0, $i.Move.movedElements.length);
      done();
    });
  });
  });
  </script>
</body>
