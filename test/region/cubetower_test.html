<!DOCTYPE html>
<html>
<head>
  <base href="..">
  <title>region.CubeTower Unit Tests</title>

  <link rel="import" href="region/cubetower.html">
  <link rel="import" href="data/configservice.html">
  <link rel="import" href="ui/moveservice.html">
  <link rel="import" href="testbase.html">
  <link rel="import" href="third_party/chance.html">
  <link rel="import" href="third_party/di.html">
  <link rel="import" href="utils.html">
</head>
<body>
<script>
DIJS
.with('pb.$registry', require => new (require('pb.ui.RegistryService'))())
.constant('doc', document.currentScript.ownerDocument)
.constant('pb.ui.MoveService', {
  movedElements: []
})
.constant('Chance', {
  binom() { }
})
.run(require => {

  const $ = require('pb.$');
  const $registry = require('pb.$registry');
  const _ = require('pb._');

  const Chance = require('pb.Chance');
  const Config = require('pb.data.ConfigService');
  const CubeTower = require('pb.region.CubeTower');
  const doc = require('doc');
  const expect = require('expect');
  const Move = require('pb.ui.MoveService');
  const Utils = require('pb.Utils');

  const Droppable = CubeTower.TowerDroppable;

  describe('region.CubeTower', () => {
    beforeEach(() => {
      $registry.register(doc, Config);
    });

    describe('get pickableChildCount', () => {
      it('should return the correct number of child count', () => {
        let tower = doc.createElement('pb-r-cubetower');
        Object.setPrototypeOf(tower, CubeTower.prototype);

        let stuckEl = doc.createElement('div');
        $(stuckEl).attr('pb-stagger-level', 1);
        tower.appendChild(stuckEl);
        tower.appendChild(doc.createElement('div'));
        tower.appendChild(doc.createElement('div'));

        expect(tower.pickableChildCount).to.equal(2);
      });
    });

    afterEach(() => {
      Move.movedElements.splice(0, Move.movedElements.length);
    });
  });
  });
  </script>
</body>
